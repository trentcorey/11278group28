{
  "{\"assumptions\":{},\"sourceRoot\":\"C:\\\\Users\\\\chenr\\\\Desktop\\\\11278group28\\\\gatorecycler\\\\\",\"caller\":{\"name\":\"@babel/node\"},\"cwd\":\"C:\\\\Users\\\\chenr\\\\Desktop\\\\11278group28\\\\gatorecycler\",\"filename\":\"C:\\\\Users\\\\chenr\\\\Desktop\\\\11278group28\\\\gatorecycler\\\\server.js\",\"targets\":{},\"cloneInputAst\":true,\"babelrc\":false,\"configFile\":false,\"browserslistConfigFile\":false,\"passPerPreset\":false,\"envName\":\"development\",\"root\":\"C:\\\\Users\\\\chenr\\\\Desktop\\\\11278group28\\\\gatorecycler\",\"rootMode\":\"root\",\"plugins\":[],\"presets\":[]}:7.16.0": {
    "metadata": {},
    "options": {
      "assumptions": {},
      "sourceRoot": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler\\",
      "caller": {
        "name": "@babel/node"
      },
      "cwd": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler",
      "filename": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler\\server.js",
      "targets": {},
      "cloneInputAst": true,
      "babelrc": false,
      "configFile": false,
      "browserslistConfigFile": false,
      "envName": "development",
      "root": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler",
      "rootMode": "root",
      "sourceMaps": "both",
      "ast": false,
      "passPerPreset": false,
      "plugins": [],
      "presets": [],
      "parserOpts": {
        "sourceType": "module",
        "sourceFileName": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler\\server.js",
        "plugins": []
      },
      "generatorOpts": {
        "filename": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler\\server.js",
        "comments": true,
        "compact": "auto",
        "sourceMaps": "both",
        "sourceRoot": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler\\",
        "sourceFileName": "server.js"
      }
    },
    "ast": null,
    "code": "const express = require('express');\n\nconst multer = require('multer');\n\nconst multerS3 = require('multer-s3');\n\nconst fs = require('fs');\n\nconst aws = require('aws-sdk');\n\nconst mysql = require('mysql');\n\nconst spawn = require(\"child_process\").spawn;\n\nconst path = require('path');\n\nconst S3Zipper = require('aws-s3-zipper');\n\nconst app = express();\nconst port = process.env.PORT || 5000;\napp.use(express.json());\napp.use(express.urlencoded());\napp.use(\"/uploads\", express.static(\"uploads\"));\napp.use(function (req, res, next) {\n  res.header(\"Access-Control-Allow-Origin\", \"*\");\n  res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept, Authorization\");\n  res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\n  next();\n});\napp.use(express.static(path.join(__dirname, 'client', 'build')));\nconst s3 = new aws.S3({\n  accessKeyId: '',\n  secretAccessKey: ''\n});\nconst connection = mysql.createConnection({\n  host: 'cen3907database.c2ulacfq2lky.us-east-2.rds.amazonaws.com',\n  user: 'admin',\n  password: 'Mirksu2001',\n  port: '3306',\n  database: 'image_database'\n});\nconnection.connect(function (err) {\n  if (err) {\n    throw err;\n  } else {\n    console.log('Connected to mySQL');\n  }\n});\nconst server = app.listen(port, function () {\n  const port = server.address().port;\n  console.log('Server listening at http://localhost:%s', port);\n}); // Uploading an image to the server\n\nvar storage = multer.diskStorage({\n  destination: function (req, file, cb) {\n    cb(null, 'uploads');\n  },\n  filename: function (req, file, cb) {\n    cb(null, Date.now() + '-' + file.originalname);\n  }\n});\nvar upload = multer({\n  storage: storage\n});\nvar uploadS3 = multer({\n  storage: multerS3({\n    s3: s3,\n    bucket: 'cen3907imagedb',\n    acl: 'public-read',\n    metadata: function (req, file, cb) {\n      cb(null, {\n        fieldName: file.fieldname\n      });\n    },\n    key: function (req, file, cb) {\n      cb(null, Date.now().toString() + '.jpg');\n    }\n  })\n});\napp.post('/detect_image', upload.single('file'), async function (req, res) {\n  console.log(\"Image uploaded for detection...\"); // Calls python script to automatically detect objects in the image\n\n  const python = spawn('python', ['CNN/image_detect.py', req.file.path]);\n  python.on('close', code => {\n    console.log('Finished detection');\n    res.sendFile(__dirname + \"/uploads/result.jpg\");\n  });\n});\napp.post('/upload', uploadS3.single('file'), function (req, res) {\n  const uploaded_to_filepath = req.file.location;\n  console.log(\"Image uploaded!\");\n  console.log(req.file.path);\n  var data_to_post = {\n    Image_Filepath: uploaded_to_filepath\n  }; // Upload image filepath to database\n\n  connection.query(\"INSERT INTO Images SET ?;\", data_to_post, function (err, result) {\n    if (err) throw err;\n    insert_id = result.insertId;\n    console.log(\"ID inserted: \" + insert_id);\n    return res.send({\n      \"image_id\": \"\" + insert_id\n    });\n  });\n});\napp.post('/upload_annotation_results', function (req, res) {\n  var sql = \"INSERT INTO Annotation_Table SET ?;\";\n  console.log(insert_id);\n\n  for (var i = 0; i < req.body.length; i++) {\n    var data_to_post = {\n      ImageID: insert_id,\n      SectionID: req.body[i].SectionID,\n      x_min: req.body[i].x_min,\n      y_min: req.body[i].y_min,\n      x_max: req.body[i].x_max,\n      y_max: req.body[i].y_max,\n      class_id: req.body[i].class_id\n    };\n    connection.query(sql, [data_to_post], function (err, result) {\n      if (err) throw err;\n      console.log(\"Section inserted.\");\n    });\n  }\n});\napp.delete('/delete_result', function (req, res) {\n  console.log(\"Deleting result\");\n  const python = spawn('python', ['python_helpers/delete_result.py']);\n  python.on('close', code => {\n    console.log('Result deleted');\n    res.send(\"Deleted \");\n  });\n});\napp.get('/annotations', function (req, res) {\n  // SQL query\n  var sql = \"SELECT * FROM Annotation_Table INNER JOIN Images ON Annotation_Table.ImageID = Images.ID\";\n  var stream = fs.openSync(__dirname + \"/uploads/annotations.txt\", 'a'); // Tried promise chaining. It didn't work, because I'm not touching recursion, lol.\n  // This solution might be a little unworkable at scale but... this is a prototype, right?\n  // I'll learn promises later.\n\n  connection.query(sql, function (err, result) {\n    if (err) throw err;\n    if (result.length < 0) throw err;\n    var curr = result[0];\n    var curr_ID = curr.ImageID;\n    var imgpath = curr.Image_Filepath;\n    var annotation = curr.x_min + \",\" + curr.x_max + \",\" + curr.x_max + \",\" + curr.x_min + \",\" + curr.class_id + \" \";\n    var imgpath_and_annotations = imgpath + \" \" + annotation;\n\n    for (var i = 1; i < result.length; i++) {\n      console.log(curr_ID);\n      curr = result[i];\n\n      if (curr_ID !== curr.ImageID) {\n        imgpath = curr.Image_Filepath;\n        curr_ID = curr.ImageID;\n        console.log(imgpath_and_annotations);\n        fs.appendFileSync(stream, imgpath_and_annotations);\n        fs.appendFileSync(stream, '\\n');\n        imgpath_and_annotations = imgpath;\n      }\n\n      var annotation = curr.x_min + \",\" + curr.x_max + \",\" + curr.x_max + \",\" + curr.x_min + \",\" + curr.class_id + \" \";\n      var imgpath_and_annotations = imgpath_and_annotations + \" \" + annotation;\n    }\n\n    var filepath = __dirname + \"/uploads/annotations.txt\";\n    res.download(filepath);\n  });\n});\napp.delete(\"/delete_annotation\", function (req, res) {\n  fs.unlinkSync(\"uploads/annotations.txt\");\n  console.log(\"Deleting annotations after download\");\n});\napp.get('/image_zip_download', function (req, res) {\n  console.log(\"Testing\");\n\n  const {\n    exec\n  } = require('child_process');\n\n  exec('aws s3 cp s3://cen3907imagedb/images ./ --recursive');\n  res.send(\"Hello\");\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZlci5qcyJdLCJuYW1lcyI6WyJleHByZXNzIiwicmVxdWlyZSIsIm11bHRlciIsIm11bHRlclMzIiwiZnMiLCJhd3MiLCJteXNxbCIsInNwYXduIiwicGF0aCIsIlMzWmlwcGVyIiwiYXBwIiwicG9ydCIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwidXNlIiwianNvbiIsInVybGVuY29kZWQiLCJzdGF0aWMiLCJyZXEiLCJyZXMiLCJuZXh0IiwiaGVhZGVyIiwiam9pbiIsIl9fZGlybmFtZSIsInMzIiwiUzMiLCJhY2Nlc3NLZXlJZCIsInNlY3JldEFjY2Vzc0tleSIsImNvbm5lY3Rpb24iLCJjcmVhdGVDb25uZWN0aW9uIiwiaG9zdCIsInVzZXIiLCJwYXNzd29yZCIsImRhdGFiYXNlIiwiY29ubmVjdCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJzZXJ2ZXIiLCJsaXN0ZW4iLCJhZGRyZXNzIiwic3RvcmFnZSIsImRpc2tTdG9yYWdlIiwiZGVzdGluYXRpb24iLCJmaWxlIiwiY2IiLCJmaWxlbmFtZSIsIkRhdGUiLCJub3ciLCJvcmlnaW5hbG5hbWUiLCJ1cGxvYWQiLCJ1cGxvYWRTMyIsImJ1Y2tldCIsImFjbCIsIm1ldGFkYXRhIiwiZmllbGROYW1lIiwiZmllbGRuYW1lIiwia2V5IiwidG9TdHJpbmciLCJwb3N0Iiwic2luZ2xlIiwicHl0aG9uIiwib24iLCJjb2RlIiwic2VuZEZpbGUiLCJ1cGxvYWRlZF90b19maWxlcGF0aCIsImxvY2F0aW9uIiwiZGF0YV90b19wb3N0IiwiSW1hZ2VfRmlsZXBhdGgiLCJxdWVyeSIsInJlc3VsdCIsImluc2VydF9pZCIsImluc2VydElkIiwic2VuZCIsInNxbCIsImkiLCJib2R5IiwibGVuZ3RoIiwiSW1hZ2VJRCIsIlNlY3Rpb25JRCIsInhfbWluIiwieV9taW4iLCJ4X21heCIsInlfbWF4IiwiY2xhc3NfaWQiLCJkZWxldGUiLCJnZXQiLCJzdHJlYW0iLCJvcGVuU3luYyIsImN1cnIiLCJjdXJyX0lEIiwiaW1ncGF0aCIsImFubm90YXRpb24iLCJpbWdwYXRoX2FuZF9hbm5vdGF0aW9ucyIsImFwcGVuZEZpbGVTeW5jIiwiZmlsZXBhdGgiLCJkb3dubG9hZCIsInVubGlua1N5bmMiLCJleGVjIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxTQUFELENBQXZCOztBQUNBLE1BQU1DLE1BQU0sR0FBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBdEI7O0FBQ0EsTUFBTUUsUUFBUSxHQUFHRixPQUFPLENBQUMsV0FBRCxDQUF4Qjs7QUFDQSxNQUFNRyxFQUFFLEdBQUdILE9BQU8sQ0FBQyxJQUFELENBQWxCOztBQUNBLE1BQU1JLEdBQUcsR0FBR0osT0FBTyxDQUFDLFNBQUQsQ0FBbkI7O0FBQ0EsTUFBTUssS0FBSyxHQUFHTCxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxNQUFNTSxLQUFLLEdBQUdOLE9BQU8sQ0FBQyxlQUFELENBQVAsQ0FBeUJNLEtBQXZDOztBQUNBLE1BQU1DLElBQUksR0FBR1AsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTVEsUUFBUSxHQUFHUixPQUFPLENBQUUsZUFBRixDQUF4Qjs7QUFDQSxNQUFNUyxHQUFHLEdBQUdWLE9BQU8sRUFBbkI7QUFFQSxNQUFNVyxJQUFJLEdBQUdDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxJQUFaLElBQW9CLElBQWpDO0FBSUFKLEdBQUcsQ0FBQ0ssR0FBSixDQUFRZixPQUFPLENBQUNnQixJQUFSLEVBQVI7QUFDQU4sR0FBRyxDQUFDSyxHQUFKLENBQVFmLE9BQU8sQ0FBQ2lCLFVBQVIsRUFBUjtBQUNBUCxHQUFHLENBQUNLLEdBQUosQ0FBUSxVQUFSLEVBQW9CZixPQUFPLENBQUNrQixNQUFSLENBQWUsU0FBZixDQUFwQjtBQUNBUixHQUFHLENBQUNLLEdBQUosQ0FBUSxVQUFTSSxHQUFULEVBQWNDLEdBQWQsRUFBbUJDLElBQW5CLEVBQXlCO0FBQzdCRCxFQUFBQSxHQUFHLENBQUNFLE1BQUosQ0FBVyw2QkFB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QUNULEtBQUwsR0FBYSxHQUFiLEdBQW1CUyxJQUFJLENBQUNQLEtBQXhCLEdBQWdDLEdBQWhDLEdBQXNDTyxJQUFJLENBQUNQLEtBQTNDLEdBQW1ELEdBQW5ELEdBQXlETyxJQUFJLENBQUNULEtBQTlELEdBQXNFLEdBQXRFLEdBQTRFUyxJQUFJLENBQUNMLFFBQWpGLEdBQTRGLEdBQTdHO0FBQ0EsVUFBSVMsdUJBQXVCLEdBQUdBLHVCQUF1QixHQUFHLEdBQTFCLEdBQWdDRCxVQUE5RDtBQUNIOztBQUVELFFBQUlHLFFBQVEsR0FBR3hFLFNBQVMsR0FBRywwQkFBM0I7QUFFQUosSUFBQUEsR0FBRyxDQUFDNkUsUUFBSixDQUFhRCxRQUFiO0FBQ0gsR0E3QkQ7QUErQkgsQ0F4Q0Q7QUEwQ0F0RixHQUFHLENBQUM0RSxNQUFKLENBQVcsb0JBQVgsRUFBaUMsVUFBU25FLEdBQVQsRUFBY0MsR0FBZCxFQUFtQjtBQUNoRGhCLEVBQUFBLEVBQUUsQ0FBQzhGLFVBQUgsQ0FBYyx5QkFBZDtBQUNBN0QsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVkscUNBQVo7QUFDSCxDQUhEO0FBTUE1QixHQUFHLENBQUM2RSxHQUFKLENBQVEscUJBQVIsRUFBK0IsVUFBVXBFLEdBQVYsRUFBZUMsR0FBZixFQUFvQjtBQUMvQ2lCLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFNBQVo7O0FBQ0EsUUFBTTtBQUFDNkQsSUFBQUE7QUFBRCxNQUFTbEcsT0FBTyxDQUFDLGVBQUQsQ0FBdEI7O0FBQ0FrRyxFQUFBQSxJQUFJLENBQUMscURBQUQsQ0FBSjtBQUNBL0UsRUFBQUEsR0FBRyxDQUFDc0QsSUFBSixDQUFTLE9BQVQ7QUFDSCxDQUxEIiwic291cmNlUm9vdCI6IkM6XFxVc2Vyc1xcY2hlbnJcXERlc2t0b3BcXDExMjc4Z3JvdXAyOFxcZ2F0b3JlY3ljbGVyXFwiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xyXG5jb25zdCBtdWx0ZXIgPSByZXF1aXJlKCdtdWx0ZXInKTtcclxuY29uc3QgbXVsdGVyUzMgPSByZXF1aXJlKCdtdWx0ZXItczMnKTtcclxuY29uc3QgZnMgPSByZXF1aXJlKCdmcycpO1xyXG5jb25zdCBhd3MgPSByZXF1aXJlKCdhd3Mtc2RrJyk7XHJcbmNvbnN0IG15c3FsID0gcmVxdWlyZSgnbXlzcWwnKTtcclxuY29uc3Qgc3Bhd24gPSByZXF1aXJlKFwiY2hpbGRfcHJvY2Vzc1wiKS5zcGF3bjtcclxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKVxyXG5jb25zdCBTM1ppcHBlciA9IHJlcXVpcmUgKCdhd3MtczMtemlwcGVyJylcclxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xyXG5cclxuY29uc3QgcG9ydCA9IHByb2Nlc3MuZW52LlBPUlQgfHwgNTAwMDtcclxuXHJcblxyXG5cclxuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XHJcbmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKCkpO1xyXG5hcHAudXNlKFwiL3VwbG9hZHNcIiwgZXhwcmVzcy5zdGF0aWMoXCJ1cGxvYWRzXCIpKTtcclxuYXBwLnVzZShmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgcmVzLmhlYWRlcihcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiLCBcIipcIik7XHJcbiAgICByZXMuaGVhZGVyKFwiQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVyc1wiLCBcIk9yaWdpbiwgWC1SZXF1ZXN0ZWQtV2l0aCwgQ29udGVudC1UeXBlLCBBY2NlcHQsIEF1dGhvcml6YXRpb25cIik7XHJcbiAgICByZXMuaGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJywgJ1BVVCwgUE9TVCwgR0VULCBERUxFVEUsIE9QVElPTlMnKTtcclxuICAgIG5leHQoKTtcclxufSk7XHJcblxyXG5hcHAudXNlKGV4cHJlc3Muc3RhdGljKHBhdGguam9pbihfX2Rpcm5hbWUsICdjbGllbnQnLCAnYnVpbGQnKSkpO1xyXG5cclxuY29uc3QgczMgPSBuZXcgYXdzLlMzKHtcclxuICAgIGFjY2Vzc0tleUlkOiAnJyxcclxuICAgIHNlY3JldEFjY2Vzc0tleTogJycgXHJcbn0pO1xyXG5cclxuY29uc3QgY29ubmVjdGlvbiA9IG15c3FsLmNyZWF0ZUNvbm5lY3Rpb24oe1xyXG4gICAgaG9zdCAgICAgICAgOiAnY2VuMzkwN2RhdGFiYXNlLmMydWxhY2ZxMmxreS51cy1lYXN0LTIucmRzLmFtYXpvbmF3cy5jb20nLFxyXG4gICAgdXNlciAgICAgICAgOiAnYWRtaW4nLFxyXG4gICAgcGFzc3dvcmQgICAgOiAnTWlya3N1MjAwMScsXHJcbiAgICBwb3J0ICAgICAgICA6ICczMzA2JyxcclxuICAgIGRhdGFiYXNlICAgIDogJ2ltYWdlX2RhdGFiYXNlJ1xyXG59KTtcclxuXHJcbmNvbm5lY3Rpb24uY29ubmVjdChmdW5jdGlvbihlcnIpIHtcclxuICAgIGlmIChlcnIpIHtcclxuICAgICAgICB0aHJvdyBlcnJcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Nvbm5lY3RlZCB0byBteVNRTCcpO1xyXG4gICAgfVxyXG59KTtcclxuXHJcbmNvbnN0IHNlcnZlciA9IGFwcC5saXN0ZW4ocG9ydCwgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IHNlcnZlci5hZGRyZXNzKCkucG9ydDtcclxuXHJcbiAgICBjb25zb2xlLmxvZygnU2VydmVyIGxpc3RlbmluZyBhdCBodHRwOi8vbG9jYWxob3N0OiVzJywgcG9ydCk7XHJcblxyXG59KTtcclxuXHJcbi8vIFVwbG9hZGluZyBhbiBpbWFnZSB0byB0aGUgc2VydmVyXHJcbnZhciBzdG9yYWdlID0gbXVsdGVyLmRpc2tTdG9yYWdlKHtcclxuICAgIGRlc3RpbmF0aW9uOiBmdW5jdGlvbiAocmVxLCBmaWxlLCBjYikge1xyXG4gICAgICAgIGNiKG51bGwsICd1cGxvYWRzJylcclxuICAgIH0sXHJcbiAgICBmaWxlbmFtZTogZnVuY3Rpb24gKHJlcSwgZmlsZSwgY2IpIHtcclxuICAgICAgICBjYihudWxsLCBEYXRlLm5vdygpICsgJy0nICsgZmlsZS5vcmlnaW5hbG5hbWUpXHJcbiAgICB9XHJcbn0pXHJcblxyXG52YXIgdXBsb2FkID0gbXVsdGVyKHtzdG9yYWdlOiBzdG9yYWdlfSk7XHJcblxyXG52YXIgdXBsb2FkUzMgPSBtdWx0ZXIoe1xyXG4gICAgc3RvcmFnZTogbXVsdGVyUzMoe1xyXG4gICAgICAgIHMzOiBzMyxcclxuICAgICAgICBidWNrZXQ6ICdjZW4zOTA3aW1hZ2VkYicsXHJcbiAgICAgICAgYWNsOiAncHVibGljLXJlYWQnLFxyXG4gICAgICAgIG1ldGFkYXRhOiBmdW5jdGlvbiAocmVxLCBmaWxlLCBjYikge1xyXG4gICAgICAgICAgICBjYihudWxsLCB7ZmllbGROYW1lOiBmaWxlLmZpZWxkbmFtZX0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAga2V5OiBmdW5jdGlvbiAocmVxLCBmaWxlLCBjYikge1xyXG4gICAgICAgICAgICBjYihudWxsLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkgKyAnLmpwZycpXHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufSlcclxuXHJcbmFwcC5wb3N0KCcvZGV0ZWN0X2ltYWdlJywgdXBsb2FkLnNpbmdsZSgnZmlsZScpLCBhc3luYyBmdW5jdGlvbihyZXEsIHJlcykge1xyXG4gICAgY29uc29sZS5sb2coXCJJbWFnZSB1cGxvYWRlZCBmb3IgZGV0ZWN0aW9uLi4uXCIpO1xyXG4gICAgLy8gQ2FsbHMgcHl0aG9uIHNjcmlwdCB0byBhdXRvbWF0aWNhbGx5IGRldGVjdCBvYmplY3RzIGluIHRoZSBpbWFnZVxyXG4gICAgY29uc3QgcHl0aG9uID0gc3Bhd24oJ3B5dGhvbicsIFsnQ05OL2ltYWdlX2RldGVjdC5weScsIHJlcS5maWxlLnBhdGhdKTtcclxuICAgIHB5dGhvbi5vbignY2xvc2UnLCAoY29kZSkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdGaW5pc2hlZCBkZXRlY3Rpb24nKVxyXG4gICAgICAgIHJlcy5zZW5kRmlsZShfX2Rpcm5hbWUgKyBcIi91cGxvYWRzL3Jlc3VsdC5qcGdcIilcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmFwcC5wb3N0KCcvdXBsb2FkJywgdXBsb2FkUzMuc2luZ2xlKCdmaWxlJyksIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zdCB1cGxvYWRlZF90b19maWxlcGF0aCA9IHJlcS5maWxlLmxvY2F0aW9uO1xyXG4gICAgY29uc29sZS5sb2coXCJJbWFnZSB1cGxvYWRlZCFcIik7XHJcbiAgICBjb25zb2xlLmxvZyhyZXEuZmlsZS5wYXRoKTtcclxuXHJcbiAgICB2YXIgZGF0YV90b19wb3N0ID0ge1xyXG4gICAgICAgIEltYWdlX0ZpbGVwYXRoOiB1cGxvYWRlZF90b19maWxlcGF0aFxyXG4gICAgfVxyXG5cclxuICAgIC8vIFVwbG9hZCBpbWFnZSBmaWxlcGF0aCB0byBkYXRhYmFzZVxyXG4gICAgY29ubmVjdGlvbi5xdWVyeShcIklOU0VSVCBJTlRPIEltYWdlcyBTRVQgPztcIiwgZGF0YV90b19wb3N0LCBmdW5jdGlvbihlcnIsIHJlc3VsdCkge1xyXG4gICAgICAgIGlmIChlcnIpIHRocm93IGVycjtcclxuICAgICAgICBpbnNlcnRfaWQgPSByZXN1bHQuaW5zZXJ0SWQ7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJJRCBpbnNlcnRlZDogXCIgKyBpbnNlcnRfaWQpO1xyXG4gICAgICAgIHJldHVybiByZXMuc2VuZCh7XCJpbWFnZV9pZFwiOiBcIlwiICsgaW5zZXJ0X2lkfSlcclxuICAgIH0pO1xyXG59KTtcclxuXHJcbmFwcC5wb3N0KCcvdXBsb2FkX2Fubm90YXRpb25fcmVzdWx0cycsIGZ1bmN0aW9uKHJlcSwgcmVzKSB7XHJcbiAgICBcclxuICAgIHZhciBzcWwgPSBcIklOU0VSVCBJTlRPIEFubm90YXRpb25fVGFibGUgU0VUID87XCJcclxuICAgIGNvbnNvbGUubG9nKGluc2VydF9pZCk7XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlcS5ib2R5Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgdmFyIGRhdGFfdG9fcG9zdCA9IHtcclxuICAgICAgICAgICAgSW1hZ2VJRDogaW5zZXJ0X2lkLFxyXG4gICAgICAgICAgICBTZWN0aW9uSUQ6IHJlcS5ib2R5W2ldLlNlY3Rpb25JRCxcclxuICAgICAgICAgICAgeF9taW46IHJlcS5ib2R5W2ldLnhfbWluLFxyXG4gICAgICAgICAgICB5X21pbjogcmVxLmJvZHlbaV0ueV9taW4sXHJcbiAgICAgICAgICAgIHhfbWF4OiByZXEuYm9keVtpXS54X21heCxcclxuICAgICAgICAgICAgeV9tYXg6IHJlcS5ib2R5W2ldLnlfbWF4LFxyXG4gICAgICAgICAgICBjbGFzc19pZDogcmVxLmJvZHlbaV0uY2xhc3NfaWRcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbm5lY3Rpb24ucXVlcnkoc3FsLCBbZGF0YV90b19wb3N0XSwgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcclxuICAgICAgICAgICAgaWYgKGVycikgdGhyb3cgZXJyO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlY3Rpb24gaW5zZXJ0ZWQuXCIpXHJcbiAgICAgICAgfSlcclxuICAgIH1cclxufSlcclxuXHJcbmFwcC5kZWxldGUoJy9kZWxldGVfcmVzdWx0JywgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiRGVsZXRpbmcgcmVzdWx0XCIpXHJcbiAgICBjb25zdCBweXRob24gPSBzcGF3bigncHl0aG9uJywgWydweXRob25faGVscGVycy9kZWxldGVfcmVzdWx0LnB5J10pO1xyXG5cclxuICAgIHB5dGhvbi5vbignY2xvc2UnLCAoY29kZSkgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdSZXN1bHQgZGVsZXRlZCcpXHJcbiAgICAgICAgcmVzLnNlbmQoXCJEZWxldGVkIFwiKVxyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuYXBwLmdldCgnL2Fubm90YXRpb25zJywgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgIC8vIFNRTCBxdWVyeVxyXG4gICAgdmFyIHNxbCA9IFwiU0VMRUNUICogRlJPTSBBbm5vdGF0aW9uX1RhYmxlIElOTkVSIEpPSU4gSW1hZ2VzIE9OIEFubm90YXRpb25fVGFibGUuSW1hZ2VJRCA9IEltYWdlcy5JRFwiXHJcbiAgICB2YXIgc3RyZWFtID0gZnMub3BlblN5bmMoX19kaXJuYW1lICsgXCIvdXBsb2Fkcy9hbm5vdGF0aW9ucy50eHRcIiwgJ2EnKVxyXG5cclxuICAgIC8vIFRyaWVkIHByb21pc2UgY2hhaW5pbmcuIEl0IGRpZG4ndCB3b3JrLCBiZWNhdXNlIEknbSBub3QgdG91Y2hpbmcgcmVjdXJzaW9uLCBsb2wuXHJcbiAgICAvLyBUaGlzIHNvbHV0aW9uIG1pZ2h0IGJlIGEgbGl0dGxlIHVud29ya2FibGUgYXQgc2NhbGUgYnV0Li4uIHRoaXMgaXMgYSBwcm90b3R5cGUsIHJpZ2h0P1xyXG4gICAgLy8gSSdsbCBsZWFybiBwcm9taXNlcyBsYXRlci5cclxuXHJcbiAgICBjb25uZWN0aW9uLnF1ZXJ5KHNxbCwgZnVuY3Rpb24oZXJyLCByZXN1bHQpIHtcclxuICAgICAgICBpZiAoZXJyKSB0aHJvdyBlcnI7XHJcblxyXG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoIDwgMCkgdGhyb3cgZXJyO1xyXG4gICAgICAgIHZhciBjdXJyID0gcmVzdWx0WzBdO1xyXG4gICAgICAgIHZhciBjdXJyX0lEID0gY3Vyci5JbWFnZUlEO1xyXG4gICAgICAgIHZhciBpbWdwYXRoID0gY3Vyci5JbWFnZV9GaWxlcGF0aDtcclxuICAgICAgICB2YXIgYW5ub3RhdGlvbiA9IGN1cnIueF9taW4gKyBcIixcIiArIGN1cnIueF9tYXggKyBcIixcIiArIGN1cnIueF9tYXggKyBcIixcIiArIGN1cnIueF9taW4gKyBcIixcIiArIGN1cnIuY2xhc3NfaWQgKyBcIiBcIlxyXG4gICAgICAgIHZhciBpbWdwYXRoX2FuZF9hbm5vdGF0aW9ucyA9IGltZ3BhdGggKyBcIiBcIiArIGFubm90YXRpb247XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcmVzdWx0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGN1cnJfSUQpXHJcbiAgICAgICAgICAgIGN1cnIgPSByZXN1bHRbaV1cclxuICAgICAgICAgICAgaWYgKGN1cnJfSUQgIT09IGN1cnIuSW1hZ2VJRCkge1xyXG4gICAgICAgICAgICAgICAgaW1ncGF0aCA9IGN1cnIuSW1hZ2VfRmlsZXBhdGg7XHJcbiAgICAgICAgICAgICAgICBjdXJyX0lEID0gY3Vyci5JbWFnZUlEO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW1ncGF0aF9hbmRfYW5ub3RhdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgZnMuYXBwZW5kRmlsZVN5bmMoc3RyZWFtLCBpbWdwYXRoX2FuZF9hbm5vdGF0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBmcy5hcHBlbmRGaWxlU3luYyhzdHJlYW0sICdcXG4nKTtcclxuICAgICAgICAgICAgICAgIGltZ3BhdGhfYW5kX2Fubm90YXRpb25zID0gaW1ncGF0aDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIGFubm90YXRpb24gPSBjdXJyLnhfbWluICsgXCIsXCIgKyBjdXJyLnhfbWF4ICsgXCIsXCIgKyBjdXJyLnhfbWF4ICsgXCIsXCIgKyBjdXJyLnhfbWluICsgXCIsXCIgKyBjdXJyLmNsYXNzX2lkICsgXCIgXCJcclxuICAgICAgICAgICAgdmFyIGltZ3BhdGhfYW5kX2Fubm90YXRpb25zID0gaW1ncGF0aF9hbmRfYW5ub3RhdGlvbnMgKyBcIiBcIiArIGFubm90YXRpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBmaWxlcGF0aCA9IF9fZGlybmFtZSArIFwiL3VwbG9hZHMvYW5ub3RhdGlvbnMudHh0XCI7XHJcblxyXG4gICAgICAgIHJlcy5kb3dubG9hZChmaWxlcGF0aCkgXHJcbiAgICB9KVxyXG5cclxufSlcclxuXHJcbmFwcC5kZWxldGUoXCIvZGVsZXRlX2Fubm90YXRpb25cIiwgZnVuY3Rpb24ocmVxLCByZXMpIHtcclxuICAgIGZzLnVubGlua1N5bmMoXCJ1cGxvYWRzL2Fubm90YXRpb25zLnR4dFwiKTtcclxuICAgIGNvbnNvbGUubG9nKFwiRGVsZXRpbmcgYW5ub3RhdGlvbnMgYWZ0ZXIgZG93bmxvYWRcIilcclxufSlcclxuXHJcblxyXG5hcHAuZ2V0KCcvaW1hZ2VfemlwX2Rvd25sb2FkJywgZnVuY3Rpb24gKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIlRlc3RpbmdcIik7XHJcbiAgICBjb25zdCB7ZXhlY30gPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJylcclxuICAgIGV4ZWMoJ2F3cyBzMyBjcCBzMzovL2NlbjM5MDdpbWFnZWRiL2ltYWdlcyAuLyAtLXJlY3Vyc2l2ZScpXHJcbiAgICByZXMuc2VuZChcIkhlbGxvXCIpXHJcbn0pIl19",
    "map": {
      "version": 3,
      "sources": [
        "server.js"
      ],
      "names": [
        "express",
        "require",
        "multer",
        "multerS3",
        "fs",
        "aws",
        "mysql",
        "spawn",
        "path",
        "S3Zipper",
        "app",
        "port",
        "process",
        "env",
        "PORT",
        "use",
        "json",
        "urlencoded",
        "static",
        "req",
        "res",
        "next",
        "header",
        "join",
        "__dirname",
        "s3",
        "S3",
        "accessKeyId",
        "secretAccessKey",
        "connection",
        "createConnection",
        "host",
        "user",
        "password",
        "database",
        "connect",
        "err",
        "console",
        "log",
        "server",
        "listen",
        "address",
        "storage",
        "diskStorage",
        "destination",
        "file",
        "cb",
        "filename",
        "Date",
        "now",
        "originalname",
        "upload",
        "uploadS3",
        "bucket",
        "acl",
        "metadata",
        "fieldName",
        "fieldname",
        "key",
        "toString",
        "post",
        "single",
        "python",
        "on",
        "code",
        "sendFile",
        "uploaded_to_filepath",
        "location",
        "data_to_post",
        "Image_Filepath",
        "query",
        "result",
        "insert_id",
        "insertId",
        "send",
        "sql",
        "i",
        "body",
        "length",
        "ImageID",
        "SectionID",
        "x_min",
        "y_min",
        "x_max",
        "y_max",
        "class_id",
        "delete",
        "get",
        "stream",
        "openSync",
        "curr",
        "curr_ID",
        "imgpath",
        "annotation",
        "imgpath_and_annotations",
        "appendFileSync",
        "filepath",
        "download",
        "unlinkSync",
        "exec"
      ],
      "mappings": "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",
      "sourceRoot": "C:\\Users\\chenr\\Desktop\\11278group28\\gatorecycler\\",
      "sourcesContent": [
        "const express = require('express');\r\nconst multer = require('multer');\r\nconst multerS3 = require('multer-s3');\r\nconst fs = require('fs');\r\nconst aws = require('aws-sdk');\r\nconst mysql = require('mysql');\r\nconst spawn = require(\"child_process\").spawn;\r\nconst path = require('path')\r\nconst S3Zipper = require ('aws-s3-zipper')\r\nconst app = express();\r\n\r\nconst port = process.env.PORT || 5000;\r\n\r\n\r\n\r\napp.use(express.json());\r\napp.use(express.urlencoded());\r\napp.use(\"/uploads\", express.static(\"uploads\"));\r\napp.use(function(req, res, next) {\r\n    res.header(\"Access-Control-Allow-Origin\", \"*\");\r\n    res.header(\"Access-Control-Allow-Headers\", \"Origin, X-Requested-With, Content-Type, Accept, Authorization\");\r\n    res.header('Access-Control-Allow-Methods', 'PUT, POST, GET, DELETE, OPTIONS');\r\n    next();\r\n});\r\n\r\napp.use(express.static(path.join(__dirname, 'client', 'build')));\r\n\r\nconst s3 = new aws.S3({\r\n    accessKeyId: '',\r\n    secretAccessKey: '' \r\n});\r\n\r\nconst connection = mysql.createConnection({\r\n    host        : 'cen3907database.c2ulacfq2lky.us-east-2.rds.amazonaws.com',\r\n    user        : 'admin',\r\n    password    : 'Mirksu2001',\r\n    port        : '3306',\r\n    database    : 'image_database'\r\n});\r\n\r\nconnection.connect(function(err) {\r\n    if (err) {\r\n        throw err\r\n    } else {\r\n        console.log('Connected to mySQL');\r\n    }\r\n});\r\n\r\nconst server = app.listen(port, function () {\r\n    const port = server.address().port;\r\n\r\n    console.log('Server listening at http://localhost:%s', port);\r\n\r\n});\r\n\r\n// Uploading an image to the server\r\nvar storage = multer.diskStorage({\r\n    destination: function (req, file, cb) {\r\n        cb(null, 'uploads')\r\n    },\r\n    filename: function (req, file, cb) {\r\n        cb(null, Date.now() + '-' + file.originalname)\r\n    }\r\n})\r\n\r\nvar upload = multer({storage: storage});\r\n\r\nvar uploadS3 = multer({\r\n    storage: multerS3({\r\n        s3: s3,\r\n        bucket: 'cen3907imagedb',\r\n        acl: 'public-read',\r\n        metadata: function (req, file, cb) {\r\n            cb(null, {fieldName: file.fieldname});\r\n        },\r\n        key: function (req, file, cb) {\r\n            cb(null, Date.now().toString() + '.jpg')\r\n        }\r\n    })\r\n})\r\n\r\napp.post('/detect_image', upload.single('file'), async function(req, res) {\r\n    console.log(\"Image uploaded for detection...\");\r\n    // Calls python script to automatically detect objects in the image\r\n    const python = spawn('python', ['CNN/image_detect.py', req.file.path]);\r\n    python.on('close', (code) => {\r\n        console.log('Finished detection')\r\n        res.sendFile(__dirname + \"/uploads/result.jpg\")\r\n    });\r\n});\r\n\r\napp.post('/upload', uploadS3.single('file'), function(req, res) {\r\n    const uploaded_to_filepath = req.file.location;\r\n    console.log(\"Image uploaded!\");\r\n    console.log(req.file.path);\r\n\r\n    var data_to_post = {\r\n        Image_Filepath: uploaded_to_filepath\r\n    }\r\n\r\n    // Upload image filepath to database\r\n    connection.query(\"INSERT INTO Images SET ?;\", data_to_post, function(err, result) {\r\n        if (err) throw err;\r\n        insert_id = result.insertId;\r\n        console.log(\"ID inserted: \" + insert_id);\r\n        return res.send({\"image_id\": \"\" + insert_id})\r\n    });\r\n});\r\n\r\napp.post('/upload_annotation_results', function(req, res) {\r\n    \r\n    var sql = \"INSERT INTO Annotation_Table SET ?;\"\r\n    console.log(insert_id);\r\n    for (var i = 0; i < req.body.length; i++) {\r\n        var data_to_post = {\r\n            ImageID: insert_id,\r\n            SectionID: req.body[i].SectionID,\r\n            x_min: req.body[i].x_min,\r\n            y_min: req.body[i].y_min,\r\n            x_max: req.body[i].x_max,\r\n            y_max: req.body[i].y_max,\r\n            class_id: req.body[i].class_id\r\n        }\r\n\r\n        connection.query(sql, [data_to_post], function(err, result) {\r\n            if (err) throw err;\r\n            console.log(\"Section inserted.\")\r\n        })\r\n    }\r\n})\r\n\r\napp.delete('/delete_result', function(req, res) {\r\n    console.log(\"Deleting result\")\r\n    const python = spawn('python', ['python_helpers/delete_result.py']);\r\n\r\n    python.on('close', (code) => {\r\n        console.log('Result deleted')\r\n        res.send(\"Deleted \")\r\n    });\r\n});\r\n\r\napp.get('/annotations', function(req, res) {\r\n    // SQL query\r\n    var sql = \"SELECT * FROM Annotation_Table INNER JOIN Images ON Annotation_Table.ImageID = Images.ID\"\r\n    var stream = fs.openSync(__dirname + \"/uploads/annotations.txt\", 'a')\r\n\r\n    // Tried promise chaining. It didn't work, because I'm not touching recursion, lol.\r\n    // This solution might be a little unworkable at scale but... this is a prototype, right?\r\n    // I'll learn promises later.\r\n\r\n    connection.query(sql, function(err, result) {\r\n        if (err) throw err;\r\n\r\n        if (result.length < 0) throw err;\r\n        var curr = result[0];\r\n        var curr_ID = curr.ImageID;\r\n        var imgpath = curr.Image_Filepath;\r\n        var annotation = curr.x_min + \",\" + curr.x_max + \",\" + curr.x_max + \",\" + curr.x_min + \",\" + curr.class_id + \" \"\r\n        var imgpath_and_annotations = imgpath + \" \" + annotation;\r\n\r\n        for (var i = 1; i < result.length; i++) {\r\n            console.log(curr_ID)\r\n            curr = result[i]\r\n            if (curr_ID !== curr.ImageID) {\r\n                imgpath = curr.Image_Filepath;\r\n                curr_ID = curr.ImageID;\r\n                console.log(imgpath_and_annotations);\r\n                fs.appendFileSync(stream, imgpath_and_annotations);\r\n                fs.appendFileSync(stream, '\\n');\r\n                imgpath_and_annotations = imgpath;\r\n            }\r\n\r\n            var annotation = curr.x_min + \",\" + curr.x_max + \",\" + curr.x_max + \",\" + curr.x_min + \",\" + curr.class_id + \" \"\r\n            var imgpath_and_annotations = imgpath_and_annotations + \" \" + annotation;\r\n        }\r\n        \r\n        var filepath = __dirname + \"/uploads/annotations.txt\";\r\n\r\n        res.download(filepath) \r\n    })\r\n\r\n})\r\n\r\napp.delete(\"/delete_annotation\", function(req, res) {\r\n    fs.unlinkSync(\"uploads/annotations.txt\");\r\n    console.log(\"Deleting annotations after download\")\r\n})\r\n\r\n\r\napp.get('/image_zip_download', function (req, res) {\r\n    console.log(\"Testing\");\r\n    const {exec} = require('child_process')\r\n    exec('aws s3 cp s3://cen3907imagedb/images ./ --recursive')\r\n    res.send(\"Hello\")\r\n})"
      ]
    },
    "sourceType": "module",
    "mtime": 1636983090852
  }
}